@page "/contact"
@inject CMSContactService contactService
@inject CMSLocationService locationService
@using BlazorApp.Data
@using BlazorApp.Services.CMS
@using BlazorApp.Models
@using BlazorApp.Controllers
@using System.ComponentModel.DataAnnotations
@using System.Net.Mail
<PageTitle>Contact</PageTitle>


    <div class="page-container">
        <div class="title-layout">
            <h1>Contact</h1>
            <a><u>Home</u> > Contact </a>
        </div>
        <div class="container mt-4">
            <div class="row">
                <!-- Left Column for Text -->
                <div class="col-md-6">
                    @if(ConObj != null){
                    <h2>Onze gegevens</h2>           
                    @((MarkupString)ConObj.Context)
                    }
                    else
                    {
                         <p>Loading</p>
                    }
                </div>

                <div class="col-md-6">
                    <h1 class="mb-4">Stel ons een vraag</h1>
                    <EditForm Model="@Model" OnValidSubmit="@SubmitForm" FormName="ContactForm">
                        <DataAnnotationsValidator />
                        <Microsoft.AspNetCore.Components.Forms.ValidationSummary />
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <InputText @bind-Value="Model.Name" placeholder="Naam"  class="form-control" id="box" />
                            </div>
                            <div class="form-group col-md-6">
                                <InputText @bind-Value="Model.FirstName" placeholder="Voornaam" class="form-control" id="box" />
                            </div>
                        </div>

                        <div class="form-group">
                            <InputText @bind-Value="Model.Email" placeholder="E-mail" class="form-control" id="box" />
                        </div>

                        <div class="form-group">
                            <InputDate @bind-Value="Model.DateOfBirth" placeholder="Geboortedatum" class="form-control" id="box" />
                        </div>

                        <div class="form-group">
                            <InputText @bind-Value="Model.PhoneNumber" placeholder="Telefoonnummer" class="form-control" id="box" />
                        </div>

                        <div class="form-group">
                            <InputTextArea rows="4" @bind-Value="Model.Message" placeholder="Bericht of vraag" class="form-control" id="box" />
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" data-test-id="contact-submit-button">verstuur</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>

        <div class="container mt-4">
            <div class="row">
                <div class="col-md-6">
                @if(LocObj != null){
                    <h2>Onze locatie</h2>
                    @((MarkupString)LocObj.Context)
                }
                else
                {
                     <p>Loading</p>
                }
                </div>
                <div class="col-md-6">
                    <iframe src="https://maps.google.com/maps?width=100%25&amp;height=600&amp;hl=en&amp;q=Antwerpsesteenweg%201022%209040%20Gent+(Vision%20Oogcentrum)&amp;t=&amp;z=12&amp;ie=UTF8&amp;iwloc=B&amp;output=embed" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
    </div>







@code {
    @using System.Net

    CMSContact ConObj;
    CMSLocation LocObj;

    public ContactModel? Model { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        Model = new ContactModel();
        ConObj = await contactService.GetContact();
        LocObj = await locationService.GetLocation();
    }

    public class ContactModel
    {
        [Required(ErrorMessage = "Naam is verplicht.")]
        public string Name { get; set; }
        [Required(ErrorMessage = "Voornaam is verplicht.")]
        public string FirstName { get; set; }
        [Required(ErrorMessage = "Email is verplicht.")]
        [EmailAddress(ErrorMessage = "Voer een geldig emailadres in.")]
        public string Email { get; set; }
        [Required(ErrorMessage = "Geboortedatum is verplicht.")]
        public DateTime DateOfBirth { get; set; }
        [Required(ErrorMessage = "Telefoonnummer is verplicht.")]
        [RegularExpression(@"[0-9]{10}", ErrorMessage = "Voer een geldig telefoonnummer in.")]
        public string PhoneNumber { get; set; }
        [Required(ErrorMessage = "Een bericht is verplicht.")]
        public string Message { get; set; }
    }

    // Create references for other form fields as needed

    // Define a method to handle the form submission
    private void SubmitForm()
    {
        // Get the values from the form fields
        var name = Model.Name;
        var firstName = Model.FirstName;
        var email = Model.Email;

        // Get values from other form fields as needed
        using (SmtpClient smtpClient = new SmtpClient("your-smtp-server.com"))
        {
            smtpClient.Port = 587;
            smtpClient.Credentials = new NetworkCredential("your-username", "your-password");
            smtpClient.EnableSsl = true;

            using (MailMessage mailMessage = new MailMessage("from-email@example.com", "recipient@example.com"))
            {
                mailMessage.Subject = "Contact Form Submission";
                //mailMessage.Body = email;

                try
                {
                    smtpClient.Send(mailMessage);
                    Console.WriteLine("Email sent successfully.");
                }
                catch (Exception ex)
                {
                    Console.WriteLine("Error: " + ex.Message);
                }
            }
        }
        // Now you can use these values as needed, such as sending them in an email
    }
}

