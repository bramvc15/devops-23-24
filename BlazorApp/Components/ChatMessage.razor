@using System.Text.Json
@using BlazorApp.Data
@using BlazorApp.Services
@using BlazorApp.Models
@using BlazorApp.Controllers
@inject DatabaseContext databaseContext
@using Microsoft.AspNetCore.Components
@inject ChatbotService ChatbotService


<div class="textBubble-@(Type == "bot" ? "bot" : "user")" data-test-id="chatbox-message">
    <div>
    <div class="content">
        @if (ChatbotQuestionsList == null || visible)
        {
            <span class="message">
                @Message
            </span>
            if(Image != null) {
                <img src="@Image" alt="typing" />
            }
        } else {
            @foreach(var question in ChatbotQuestionsList)
            {
                <button class="question" @onclick="() => DisplayQuestion(question)" data-test-id="chatbox-question">
                    @question.Question
                </button>
            }
        }
    </div>
    </div>
</div>

@code {
    [Parameter]
    public string Message { get; set; }

    [Parameter]
    public string Type { get; set; }

    [Parameter]
    public string? Image { get; set; }

    [Parameter]	
    public IEnumerable<ChatBotQuestion>? ChatbotQuestionsList { get; set; }
    

    private bool visible = false;

    [Parameter]
    public EventCallback<ChatBotQuestion> QuestionClicked { get; set; }

    public async Task DisplayQuestion(ChatBotQuestion question) 
    {
        Message = question.Question;
        visible = true;
        await QuestionClicked.InvokeAsync(question);
        StateHasChanged();
    }
}