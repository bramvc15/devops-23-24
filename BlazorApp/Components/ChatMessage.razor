@using System.Text.Json
@using BlazorApp.Data
@using BlazorApp.Services.CMS
@using BlazorApp.Models
@using BlazorApp.Controllers
@using Shared
@inject DatabaseContext databaseContext
@using Microsoft.AspNetCore.Components
@inject CMSChatbotService CMSChatbotService


<div class="textBubble-@(Type == "bot" ? "bot" : "user")">
    <div>
        <div class="content">
            @if (ChatbotQuestionsList == null || visible)
            {
                <span class="message">
                     @((MarkupString)Message)
                </span>
                if (Image != null)
                {
                    <img src="@Image" alt="typing" />
                }
            }
            else
            {
                @foreach (var question in ChatbotQuestionsList)
                {
                    <button class="question" @onclick="() => DisplayQuestion(question)">
                        @question.Question
                    </button>
                }
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public string Message { get; set; }

    [Parameter]
    public string Type { get; set; }

    [Parameter]
    public string? Image { get; set; }

    [Parameter]
    public IEnumerable<CMSChatBotQuestion>? ChatbotQuestionsList { get; set; }


    private bool visible = false;

    private bool isCollapsed = false;

    [Parameter]
    public EventCallback<CMSChatBotQuestion> QuestionClicked { get; set; }

    public async Task DisplayQuestion(CMSChatBotQuestion question)
    {
        Message = question.Question;
        visible = true;
        await QuestionClicked.InvokeAsync(question);
        StateHasChanged();
    }
}